# Берём официальный образ Python версии 3.12
# slim — облегчённая версия (меньше размер)
FROM python:3.12-slim

# Запрещаем Python создавать .pyc файлы
# Это временные файлы байткода, в контейнере они не нужны
ENV PYTHONDONTWRITEBYTECODE=1

# Отключаем буферизацию stdout/stderr
# Логи будут выводиться сразу (важно для docker logs)
ENV PYTHONUNBUFFERED=1

# Устанавливаем рабочую директорию внутри контейнера
# Все последующие команды будут выполняться в /app
WORKDIR /app

# Копируем файл зависимостей в контейнер
# Делаем это отдельно, чтобы Docker кешировал установку библиотек
COPY requirements.txt .

# Устанавливаем Python-зависимости
# --no-cache-dir уменьшает размер образа
RUN pip install --no-cache-dir -r requirements.txt

# Копируем исходный код FastAPI-приложения
COPY . .

# Команда запуска контейнера
# Запускаем FastAPI через uvicorn
# --host 0.0.0.0 → сервер доступен извне контейнера
# --port 8000 → порт внутри контейнера
CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000"]
